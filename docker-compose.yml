services:
  patron-hub:
    build: .
    image: patron-hub:local
    expose:
      - "3000"
    environment:
      NODE_ENV: production
      NEXT_TELEMETRY_DISABLED: "1"
      PATRON_HUB_DATA_DIR: /data
      PATRON_HUB_ARCHIVE_DIR: /archive
      PATRON_HUB_DISABLE_AUTH: ${PATRON_HUB_DISABLE_AUTH:-0}
      PATRON_HUB_PATREON_COOKIE: ${PATRON_HUB_PATREON_COOKIE:-}
      PATRON_HUB_PATREON_MAX_PAGES: ${PATRON_HUB_PATREON_MAX_PAGES:-40}
      PATRON_HUB_PATREON_HARVEST_JOB_LIMIT: ${PATRON_HUB_PATREON_HARVEST_JOB_LIMIT:-80}
      PATRON_HUB_PATREON_HARVEST_MAX_ATTEMPTS: ${PATRON_HUB_PATREON_HARVEST_MAX_ATTEMPTS:-8}
    volumes:
      - ./server-data:/data
      - ./server-archive:/archive
    restart: unless-stopped
